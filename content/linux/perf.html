<!DOCTYPE HTML><html lang=""><head><meta charset="UTF-8"><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><title>perf Â· cheatsheet</title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" content=""><meta name="generator" content="GitBook 3.2.3"><meta name="author" content="XS Zhao"><link rel="stylesheet" href="../../gitbook/style.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-folding-chapters/folding-chapters.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-plus/search.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-page-footer/footer.css"><link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css"><link rel="stylesheet" type="text/css" href="../../custom/my.css"><meta name="HandheldFriendly" content="true"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png"><link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon"><link rel="next" href="ssh.html"><style>@media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }</style><script>window["gitbook-plugin-github-buttons"] = {"buttons":[{"user":"hansonzhao007","repo":"cheatsheet","type":"star","size":"small","count":true}]};</script></head><body><div class="book"><div class="book-summary"><div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div><nav role="navigation"><ul class="summary"><li class="chapter" data-level="1.1" data-path="../../"><a href="../../">Introduction</a></li><li class="chapter" data-level="1.2"><span>Git</span><ul class="articles"><li class="chapter" data-level="1.2.1"><a target="_blank" href="https://education.github.com/git-cheat-sheet-education.pdf">cheatsheet</a></li></ul></li><li class="chapter" data-level="1.3"><span>Linux</span><ul class="articles"><li class="chapter active" data-level="1.3.1" data-path="perf.html"><a href="perf.html">perf</a></li><li class="chapter" data-level="1.3.2" data-path="ssh.html"><a href="ssh.html">ssh</a></li><li class="chapter" data-level="1.3.3" data-path="skills.html"><a href="skills.html">skills</a></li><li class="chapter" data-level="1.3.4" data-path="inode.html"><a href="inode.html">inode</a></li></ul></li><li class="chapter" data-level="1.4"><span>Web</span><ul class="articles"><li class="chapter" data-level="1.4.1" data-path="../web/gitbook.html"><a href="../web/gitbook.html">Gitbook</a></li></ul></li><li class="divider"></li><li><a href="https://www.gitbook.com" target="blank" class="gitbook-link">Published with GitBook</a></li></ul></nav></div><div class="book-body"><div class="body-inner"><div class="book-header" role="navigation"><!-- Title --><h1><i class="fa fa-circle-o-notch fa-spin"></i> <a href="../..">perf</a></h1></div><div class="page-wrapper" tabindex="-1" role="main"><div class="page-inner"><div class="search-plus" id="book-search-results"><div class="search-noresults"><section class="normal markdown-section"><div id="anchor-navigation-ex-navbar"><i class="fa fa-anchor"></i><ul><li><span class="title-icon"></span><a href="#&#x4F7F;&#x7528;-perf-&#x5206;&#x6790;&#x6307;&#x5B9A;&#x51FD;&#x6570;&#x7684;&#x6027;&#x80FD;&#x5E76;&#x53EF;&#x89C6;&#x5316;"><b>1. </b>&#x4F7F;&#x7528; Perf &#x5206;&#x6790;&#x6307;&#x5B9A;&#x51FD;&#x6570;&#x7684;&#x6027;&#x80FD;&#x5E76;&#x53EF;&#x89C6;&#x5316;</a></li><ul><li><span class="title-icon"></span><a href="#&#x4F7F;&#x7528;&#x7684;&#x4E24;&#x4E2A;&#x811A;&#x672C;"><b>1.1. </b>&#x4F7F;&#x7528;&#x7684;&#x4E24;&#x4E2A;&#x811A;&#x672C;</a></li><ul><li><span class="title-icon"></span><a href="#sperf"><b>1.1.1. </b>sperf</a></li><li><span class="title-icon"></span><a href="#perfsvg"><b>1.1.2. </b>perfsvg</a></li></ul><li><span class="title-icon"></span><a href="#&#x5728;&#x51FD;&#x6570;&#x5185;&#x8BBE;&#x7F6E;&#x6027;&#x80FD;&#x5206;&#x6790;&#x951A;&#x70B9;"><b>1.2. </b>&#x5728;&#x51FD;&#x6570;&#x5185;&#x8BBE;&#x7F6E;&#x6027;&#x80FD;&#x5206;&#x6790;&#x951A;&#x70B9;</a></li><li><span class="title-icon"></span><a href="#&#x6027;&#x80FD;&#x5206;&#x6790;"><b>1.3. </b>&#x6027;&#x80FD;&#x5206;&#x6790;</a></li><li><span class="title-icon"></span><a href="#&#x751F;&#x6210;&#x53EF;&#x89C6;&#x56FE;"><b>1.4. </b>&#x751F;&#x6210;&#x53EF;&#x89C6;&#x56FE;</a></li></ul></ul></div><a href="#&#x4F7F;&#x7528;-perf-&#x5206;&#x6790;&#x6307;&#x5B9A;&#x51FD;&#x6570;&#x7684;&#x6027;&#x80FD;&#x5E76;&#x53EF;&#x89C6;&#x5316;" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="&#x4F7F;&#x7528;-perf-&#x5206;&#x6790;&#x6307;&#x5B9A;&#x51FD;&#x6570;&#x7684;&#x6027;&#x80FD;&#x5E76;&#x53EF;&#x89C6;&#x5316;"><a name="&#x4F7F;&#x7528;-perf-&#x5206;&#x6790;&#x6307;&#x5B9A;&#x51FD;&#x6570;&#x7684;&#x6027;&#x80FD;&#x5E76;&#x53EF;&#x89C6;&#x5316;" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;-perf-&#x5206;&#x6790;&#x6307;&#x5B9A;&#x51FD;&#x6570;&#x7684;&#x6027;&#x80FD;&#x5E76;&#x53EF;&#x89C6;&#x5316;"><i class="fa fa-link" aria-hidden="true"></i></a>1. &#x4F7F;&#x7528; Perf &#x5206;&#x6790;&#x6307;&#x5B9A;&#x51FD;&#x6570;&#x7684;&#x6027;&#x80FD;&#x5E76;&#x53EF;&#x89C6;&#x5316;</h1><h2 id="&#x4F7F;&#x7528;&#x7684;&#x4E24;&#x4E2A;&#x811A;&#x672C;"><a name="&#x4F7F;&#x7528;&#x7684;&#x4E24;&#x4E2A;&#x811A;&#x672C;" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;&#x7684;&#x4E24;&#x4E2A;&#x811A;&#x672C;"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. &#x4F7F;&#x7528;&#x7684;&#x4E24;&#x4E2A;&#x811A;&#x672C;</h2><h3 id="sperf"><a name="sperf" class="anchor-navigation-ex-anchor" href="#sperf"><i class="fa fa-link" aria-hidden="true"></i></a>1.1.1. sperf</h3><pre class="language-"><code class="lang-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> $<span class="token comment" spellcheck="true"># -eq 0 ]]; then</span>
  <span class="token keyword">echo</span> <span class="token string">&quot;  Usage: sperf &lt;commands&gt; ...&quot;</span>
  <span class="token keyword">exit</span> 0
<span class="token keyword">fi</span>

perf record -q --call-graph lbr --switch-output -- <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
</code></pre><h3 id="perfsvg"><a name="perfsvg" class="anchor-navigation-ex-anchor" href="#perfsvg"><i class="fa fa-link" aria-hidden="true"></i></a>1.1.2. perfsvg</h3><pre class="language-"><code class="lang-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> $<span class="token comment" spellcheck="true"># -eq 0 ]]; then</span>
  <span class="token keyword">echo</span> <span class="token string">&quot;  Usage: perfsvg &lt;filename&gt; ...&quot;</span>
  <span class="token keyword">exit</span> 0
<span class="token keyword">fi</span>
<span class="token comment" spellcheck="true"># get scripts</span>
ghroot<span class="token operator">=</span><span class="token string">&quot;https://raw.githubusercontent.com/brendangregg/FlameGraph/master&quot;</span>
bindir<span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${HOME}</span>/program/usr/bin&quot;</span>
st1<span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${bindir}</span>/stackcollapse-perf.pl&quot;</span>
st2<span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${bindir}</span>/flamegraph.pl&quot;</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">!</span> -f <span class="token string">&quot;<span class="token variable">${st1}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token function">mkdir</span> -p ~/program/usr/bin
  <span class="token function">wget</span> <span class="token string">&quot;<span class="token variable">${ghroot}</span>/stackcollapse-perf.pl&quot;</span> -O <span class="token string">&quot;<span class="token variable">${st1}</span>&quot;</span>
<span class="token keyword">fi</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">!</span> -f <span class="token string">&quot;<span class="token variable">${st2}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token function">mkdir</span> -p ~/program/usr/bin
  <span class="token function">wget</span> <span class="token string">&quot;<span class="token variable">${ghroot}</span>/flamegraph.pl&quot;</span> -O <span class="token string">&quot;<span class="token variable">${st2}</span>&quot;</span>
<span class="token keyword">fi</span>

rid<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>timestamp<span class="token variable">)</span></span>
pref<span class="token operator">=</span><span class="token string">&quot;/tmp/.fperf-<span class="token variable">${rid}</span>&quot;</span>
perf script -i <span class="token string">&quot;<span class="token variable">${1}</span>&quot;</span> <span class="token operator">&gt;</span> <span class="token variable">${pref}</span>.perf
perl -w <span class="token string">&quot;<span class="token variable">${st1}</span>&quot;</span> <span class="token variable">${pref}</span>.perf <span class="token operator">&gt;</span> <span class="token variable">${pref}</span>.folded
perl -w <span class="token string">&quot;<span class="token variable">${st2}</span>&quot;</span> <span class="token variable">${pref}</span>.folded <span class="token operator">&gt;</span> fperf-<span class="token variable">${rid}</span>.svg
<span class="token function">rm</span> -f <span class="token variable">${pref}</span>.perf <span class="token variable">${pref}</span>.folded
<span class="token keyword">echo</span> &quot;fperf-<span class="token variable">${rid}</span>.svg
</code></pre><h2 id="&#x5728;&#x51FD;&#x6570;&#x5185;&#x8BBE;&#x7F6E;&#x6027;&#x80FD;&#x5206;&#x6790;&#x951A;&#x70B9;"><a name="&#x5728;&#x51FD;&#x6570;&#x5185;&#x8BBE;&#x7F6E;&#x6027;&#x80FD;&#x5206;&#x6790;&#x951A;&#x70B9;" class="anchor-navigation-ex-anchor" href="#&#x5728;&#x51FD;&#x6570;&#x5185;&#x8BBE;&#x7F6E;&#x6027;&#x80FD;&#x5206;&#x6790;&#x951A;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>1.2. &#x5728;&#x51FD;&#x6570;&#x5185;&#x8BBE;&#x7F6E;&#x6027;&#x80FD;&#x5206;&#x6790;&#x951A;&#x70B9;</h2><pre class="language-"><code class="lang-c"><span class="token keyword">static</span> pid_t __perf_pid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> 
<span class="token function">debug_perf_ppid</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">const</span> pid_t ppid <span class="token operator">=</span> <span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> tmp<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">sprintf</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> <span class="token string">&quot;/proc/%d/cmdline&quot;</span><span class="token punctuation">,</span> ppid<span class="token punctuation">)</span><span class="token punctuation">;</span>
  FILE <span class="token operator">*</span> <span class="token keyword">const</span> fc <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> size_t nr <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1020</span><span class="token punctuation">,</span> fc<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token function">fclose</span><span class="token punctuation">(</span>fc<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// look for &quot;perf record&quot;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>nr <span class="token operator">&lt;</span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  tmp<span class="token punctuation">[</span>nr<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&apos;\0&apos;</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nr<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tmp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> tmp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&apos; &apos;</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
  <span class="token keyword">char</span> <span class="token operator">*</span> <span class="token keyword">const</span> perf <span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> <span class="token string">&quot;perf record&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>perf <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// it should be</span>
  __perf_pid <span class="token operator">=</span> ppid<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

  <span class="token keyword">void</span>
<span class="token function">debug_perf_switch</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>__perf_pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">kill</span><span class="token punctuation">(</span>__perf_pid<span class="token punctuation">,</span> SIGUSR2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

  <span class="token keyword">void</span>
<span class="token function">debug_perf_stop</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>__perf_pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">kill</span><span class="token punctuation">(</span>__perf_pid<span class="token punctuation">,</span> SIGINT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="&#x6027;&#x80FD;&#x5206;&#x6790;"><a name="&#x6027;&#x80FD;&#x5206;&#x6790;" class="anchor-navigation-ex-anchor" href="#&#x6027;&#x80FD;&#x5206;&#x6790;"><i class="fa fa-link" aria-hidden="true"></i></a>1.3. &#x6027;&#x80FD;&#x5206;&#x6790;</h2><pre class="language-"><code class="lang-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&quot;road_hc_util.h&quot;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&quot;road_sample.h&quot;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> rasi<span class="token punctuation">;</span>

MutableS2ShapeIndex road_index<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">double</span> kRepeat <span class="token operator">=</span> <span class="token number">500000</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> pid_t __perf_pid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> 
<span class="token function">debug_perf_ppid</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">const</span> pid_t ppid <span class="token operator">=</span> <span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> tmp<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">sprintf</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> <span class="token string">&quot;/proc/%d/cmdline&quot;</span><span class="token punctuation">,</span> ppid<span class="token punctuation">)</span><span class="token punctuation">;</span>
  FILE <span class="token operator">*</span> <span class="token keyword">const</span> fc <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> size_t nr <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1020</span><span class="token punctuation">,</span> fc<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token function">fclose</span><span class="token punctuation">(</span>fc<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// look for &quot;perf record&quot;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>nr <span class="token operator">&lt;</span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  tmp<span class="token punctuation">[</span>nr<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&apos;\0&apos;</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nr<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tmp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> tmp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&apos; &apos;</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
  <span class="token keyword">char</span> <span class="token operator">*</span> <span class="token keyword">const</span> perf <span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> <span class="token string">&quot;perf record&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>perf <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// it should be</span>
  __perf_pid <span class="token operator">=</span> ppid<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

  <span class="token keyword">void</span>
<span class="token function">debug_perf_switch</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>__perf_pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">kill</span><span class="token punctuation">(</span>__perf_pid<span class="token punctuation">,</span> SIGUSR2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

  <span class="token keyword">void</span>
<span class="token function">debug_perf_stop</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>__perf_pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">kill</span><span class="token punctuation">(</span>__perf_pid<span class="token punctuation">,</span> SIGINT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span><span class="token keyword">double</span><span class="token operator">&gt;&gt;</span> <span class="token function">initial</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// std::ifstream file(&quot;../GPS_2016_11_01&quot;);</span>
    <span class="token comment" spellcheck="true">// CSVRow row;</span>
    <span class="token function">LoadRoadIndex</span><span class="token punctuation">(</span>road_index<span class="token punctuation">,</span> <span class="token string">&quot;../shenzhen_split_edges.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span><span class="token keyword">double</span><span class="token operator">&gt;&gt;</span> <span class="token function">samples</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> s <span class="token operator">:</span> samples<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        s <span class="token operator">=</span> pair<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span><span class="token keyword">double</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token number">23.028605</span><span class="token punctuation">,</span> <span class="token number">114.8476</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> samples<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">near</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span><span class="token keyword">double</span><span class="token operator">&gt;&gt;</span><span class="token operator">&amp;</span> samples<span class="token punctuation">)</span><span class="token punctuation">{</span>
    S2ClosestEdgeQuery<span class="token operator">::</span>Options options<span class="token punctuation">;</span>
    options<span class="token punctuation">.</span><span class="token function">set_max_edges</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    S2ClosestEdgeQuery <span class="token function">query</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>road_index<span class="token punctuation">,</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    S2ClosestEdgeQuery<span class="token operator">::</span>PointTarget <span class="token function">target_edge</span><span class="token punctuation">(</span><span class="token function">S2Point</span><span class="token punctuation">(</span>S2LatLng<span class="token operator">::</span><span class="token function">FromDegrees</span><span class="token punctuation">(</span>samples<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">,</span> samples<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> started <span class="token operator">=</span> std<span class="token operator">::</span>chrono<span class="token operator">::</span>high_resolution_clock<span class="token operator">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">debug_perf_switch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> kRepeat<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> result_edge <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">FindClosestEdges</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>target_edge<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">auto</span> done <span class="token operator">=</span> std<span class="token operator">::</span>chrono<span class="token operator">::</span>high_resolution_clock<span class="token operator">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Everage near time per point(ms): &quot;</span><span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>chrono<span class="token operator">::</span>duration_cast<span class="token operator">&lt;</span>std<span class="token operator">::</span>chrono<span class="token operator">::</span>microseconds<span class="token operator">&gt;</span><span class="token punctuation">(</span>done<span class="token operator">-</span>started<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span>kRepeat <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;us&quot;</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">;</span>
    <span class="token function">debug_perf_stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">double</span> ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">debug_perf_ppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span><span class="token keyword">double</span><span class="token operator">&gt;&gt;</span> samples <span class="token operator">=</span> <span class="token function">initial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">near</span><span class="token punctuation">(</span>samples<span class="token punctuation">)</span><span class="token punctuation">;</span>

    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;In the end.&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">500000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ans <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="&#x751F;&#x6210;&#x53EF;&#x89C6;&#x56FE;"><a name="&#x751F;&#x6210;&#x53EF;&#x89C6;&#x56FE;" class="anchor-navigation-ex-anchor" href="#&#x751F;&#x6210;&#x53EF;&#x89C6;&#x56FE;"><i class="fa fa-link" aria-hidden="true"></i></a>1.4. &#x751F;&#x6210;&#x53EF;&#x89C6;&#x56FE;</h2><p>&#x5BF9;&#x751F;&#x6210;&#x7684; perf.data &#x6587;&#x4EF6;&#xFF0C;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#xFF1A;</p><pre class="language-"><code class="lang-bash">perfsvg perf.data.2018071020563854
</code></pre><p><img src="../../img/fperf.svg" alt="fperf"></p><footer class="footer"><div class="footer__container--normal" alt="
http://xszhao.science/cheatsheet/content/linux/perf.html
"><img src="data:image/gif;base64,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" width="170" height="170"><div class="footer__description--normal"><p class="paragraph footer__author--normal" style="color: #000 !important;">XS Zhao<sup class="super">&#xAE;</sup></p><p class="paragraph footer__quote--normal" style="color: #000 !important;">Stay Foolish, Stay Hungry</p><div class="footer__main--normal"><p class="paragraph footer__main__paragraph--normal copyright" style="color: #666 !important;">Copyright &#xA9; hansonzhao007 all right reserved, powered by <a href="https://github.com/aleen42" target="_blank">aleen42</a></p><p class="paragraph footer__main__paragraph--normal footer__modifyTime--normal" style="color: #666 !important;"><span style="color: #666 !important;">modified at</span> 2018-07-11 10:19:06</p></div></div></div><div class="box__issues"><span class="issue-line"><p class="issue-header"><strong>0</strong> issues reported</p></span></div></footer></section></div><div class="search-results"><div class="has-results"><h1 class="search-results-title"><span class="search-results-count"></span> results matching "<span class="search-query"></span>"</h1><ul class="search-results-list"></ul></div><div class="no-results"><h1 class="search-results-title">No results matching "<span class="search-query"></span>"</h1></div></div></div></div></div></div><a href="ssh.html" class="navigation navigation-next navigation-unique" aria-label="Next page: ssh"><i class="fa fa-angle-right"></i></a></div><script>var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"perf","level":"1.3.1","depth":2,"next":{"title":"ssh","level":"1.3.2","depth":2,"path":"content/linux/ssh.md","ref":"content/linux/ssh.md","articles":[]},"previous":{"title":"Linux","level":"1.3","depth":1,"ref":"","articles":[{"title":"perf","level":"1.3.1","depth":2,"path":"content/linux/perf.md","ref":"content/linux/perf.md","articles":[]},{"title":"ssh","level":"1.3.2","depth":2,"path":"content/linux/ssh.md","ref":"content/linux/ssh.md","articles":[]},{"title":"skills","level":"1.3.3","depth":2,"path":"content/linux/skills.md","ref":"content/linux/skills.md","articles":[]},{"title":"inode","level":"1.3.4","depth":2,"path":"content/linux/inode.md","ref":"content/linux/inode.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["prism","-highlight","addcssjs","anchor-navigation-ex","folding-chapters","-lunr","-search","search-plus","splitter","sitemap","github-buttons","page-footer"],"root":"./","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{},"splitter":{},"addcssjs":{"css":["./custom/my.css"],"js":["./custom/my.js"]},"fontsettings":{"theme":"white","family":"sans","size":2},"folding-chapters":{},"anchor-navigation-ex":{"associatedWithSummary":true,"float":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showLevel":true},"sitemap":{"hostname":"http://xszhao.science/cheatsheet"},"github-buttons":{"buttons":[{"user":"hansonzhao007","repo":"cheatsheet","type":"star","size":"small","count":true}]},"page-footer":{"isShowIssues":true,"wisdom":"Stay Foolish, Stay Hungry","copyright":"Copyright &#169; hansonzhao007","styles (normal, symmetrical)":"normal","issueNum":"8","style":"normal","repo":"hansonzhao007/cheatsheet","isShowQRCode":true,"timeColor":"#666","utcOffset":"8","format":"yyyy-MM-dd hh:mm:ss","signature":"XS Zhao","token":"","baseUri":"http://xszhao.science/cheatsheet/","copyrightColor":"#666","description":"modified at"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"search-plus":{}},"theme":"default","author":"XS Zhao","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"cheatsheet","gitbook":"*"},"file":{"path":"content/linux/perf.md","mtime":"2018-07-11T02:19:06.816Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-07-11T02:19:20.765Z"},"basePath":"../..","book":{"language":""}});
        });</script></div><script src="../../gitbook/gitbook.js"></script><script src="../../gitbook/theme.js"></script><script src="../../gitbook/gitbook-plugin-folding-chapters/folding-chapters.js"></script><script src="../../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script><script src="../../gitbook/gitbook-plugin-search-plus/search.js"></script><script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script><script src="../../gitbook/gitbook-plugin-github-buttons/plugin.js"></script><script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script><script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script><script type="text/javascript" src="../../custom/my.js"></script></body></html>